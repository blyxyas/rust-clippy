name: Deploy

on:
  push:
    branches:
      - master
      - beta
    tags:
      - rust-1.**

env:
  TARGET_BRANCH: 'gh-pages'
  SHA: '${{ github.sha }}'
  SSH_REPO: 'git@github.com:${{ github.repository }}.git'

jobs:
  deploy:
    runs-on: ubuntu-latest
    if: github.repository == 'blyxyas/rust-clippy'

    steps:
    # Run
    - name: Set tag name
      if: startswith(github.ref, 'refs/tags/')
      run: |
        TAG=$(basename ${TAGNAME})
        echo "TAG_NAME=$TAG" >> $GITHUB_ENV
      env:
        # Make sure that the reference gets expanded before injecting it
        TAGNAME: ${{ github.ref }}
    - name: Set beta to true
      if: github.ref == 'refs/heads/beta'
      run: echo "BETA=true" >> $GITHUB_ENV

    # We need to check out all files that (transitively) depend on the
    # structure of the gh-pages branch, so that we're able to change that
    # structure without breaking the deployment.
